---
import type { CollectionEntry } from 'astro:content';
import SectionTag from '../ui/SectionTag.astro';
import PostCard from '../posts/PostCard.astro';
import BriefRail from '../posts/BriefRail.astro';

interface Props {
  issue: CollectionEntry<'issues'>;
  publication: CollectionEntry<'publications'>;
  lead: CollectionEntry<'posts'> & { readingTimeMinutes?: number };
  secondary: (CollectionEntry<'posts'> & { readingTimeMinutes?: number })[];
  briefs: (CollectionEntry<'posts'> & { readingTimeMinutes?: number })[];
}

const { issue, publication, lead, secondary, briefs } = Astro.props;
const badge = `Vol ${issue.data.volume} / No ${issue.data.number}`;
const accent = publication.data.accent;
---
<div class="issue-opener" style={`--opener-accent: ${accent}`}>
  <div class="issue-opener__main">
    <article class="issue-opener__lead">
      <div class="issue-opener__lead-header">
        <span class="issue-opener__badge">{badge}</span>
        <span class="issue-opener__date">{new Date(issue.data.date).toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: 'numeric' })}</span>
      </div>
      <div class="issue-opener__section">
        <SectionTag label={lead.data.sectionId} />
      </div>
      <h2 class="issue-opener__title">
        <a href={`/posts/${lead.slug}`}>
          {lead.data.headline}
        </a>
      </h2>
      <p class="issue-opener__dek">{lead.data.dek}</p>
      <div class="issue-opener__meta">
        <span>{publication.data.name}</span>
        <span aria-hidden="true">|</span>
        <span>{lead.readingTimeMinutes} min read</span>
        <span aria-hidden="true">|</span>
        <span>{lead.data.format}</span>
      </div>
    </article>
    {secondary.length > 0 && (
      <div class="issue-opener__secondary">
        {secondary.map((post) => (
          <PostCard post={post} publication={publication} />
        ))}
      </div>
    )}
  </div>
  <div class="issue-opener__sidebar">
    {briefs.length > 0 && <BriefRail briefs={briefs} publication={publication} />}
    <div class="issue-opener__status-card">
      <div class="issue-opener__status-label">Status</div>
      <div class="issue-opener__status-row">
        <span class="issue-opener__status-value">{issue.data.status}</span>
        <span class="issue-opener__theme-tag">{issue.data.theme}</span>
      </div>
    </div>
  </div>
</div>
