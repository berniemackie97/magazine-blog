---
import SectionTag from '../ui/SectionTag.astro';
import type { CollectionEntry } from 'astro:content';

interface Props {
  posts: (CollectionEntry<'posts'> & { readingTimeMinutes?: number })[];
  sections: { id: string; label: string }[];
}

const { posts, sections } = Astro.props;
const grouped = sections
  .map((section) => ({
    section,
    items: posts.filter((post) => post.data.sectionId === section.id),
  }))
  .filter((group) => group.items.length > 0);
---
<div class="toc-card">
  <div class="toc-card__label">Table of Contents</div>
  <div class="toc-card__grid">
    {grouped.map((group) => (
      <div class="toc-card__section">
        <div class="toc-card__section-header">
          <SectionTag label={group.section.label} />
        </div>
        <ul class="toc-card__list">
          {group.items.map((post) => (
            <li>
              <a href={`/posts/${post.slug}`} class="toc-card__link">
                <span class="toc-card__link-title">
                  {post.data.headline}
                </span>
                <span class="toc-card__link-time">
                  {post.readingTimeMinutes ? `${post.readingTimeMinutes}m` : ''}
                </span>
              </a>
            </li>
          ))}
        </ul>
      </div>
    ))}
  </div>
</div>
