---
import type { CollectionEntry } from 'astro:content';

interface Props {
  publication?: CollectionEntry<'publications'> | null;
  siteTitle?: string;
}

const {
  publication = null,
  siteTitle = 'The Rack',
} = Astro.props;

// Current path for active-link state
const pathname = Astro.url.pathname;

function isActive(href: string): boolean {
  if (href === '/') return pathname === '/';
  return pathname === href || pathname.startsWith(`${href}/`);
}
---
<header class="masthead">
  <div class="masthead-bar">
    <a href="/" class="brand" aria-label={`${siteTitle} home`}>
      <div class="brand-mark" aria-hidden="true">TR</div>
      <div class="brand-title">{siteTitle}</div>
    </a>

    <nav class="nav-links" aria-label="Primary navigation">
      <a href="/issues" class={isActive('/issues') ? 'active' : ''}>Issues</a>
      <a href="/publications" class={isActive('/publications') ? 'active' : ''}>Publications</a>
      <a href="/archive" class={isActive('/archive') ? 'active' : ''}>Archive</a>
    </nav>
  </div>

  {publication && (
    <div class="publication-bar">
      <div class="publication-bar__inner">
        <span class="publication-bar__name" style={`--pub-accent: ${publication.data.accent}`}>
          {publication.data.name}
        </span>
      </div>
    </div>
  )}
</header>

<style>
  .publication-bar {
    background: var(--surface-sunken);
    border-top: 2px solid var(--ink-faint);
    padding: 0.5rem var(--page-pad);
  }

  .publication-bar__inner {
    max-width: var(--page-max);
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .publication-bar__name {
    font-family: var(--font-display);
    font-size: 0.85rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--pub-accent, var(--ink-body));
  }

  .nav-links a.active::after {
    transform: scaleX(1);
  }
</style>
